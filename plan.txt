================================================================
    项目名称：AWS 多账号 EC2 自动化商业管理与分发系统
    项目角色：技术统筹/首席架构师 (AI Partner)
    目标：实现跨账号冗余、自动化开机、可视化交付、故障自动迁移
================================================================

第一阶段：基础设施与数据建模 (Infrastructure & Database)
----------------------------------------------------------------
1.1 环境搭建：
    - 在 DigitalOcean (DO) 创建 App Platform 实例 (用于前端)。
    - 在 DO 创建 Functions 命名空间 (用于 Serverless 后端逻辑)。
    - 申请 MongoDB Atlas 免费集群 (用于持久化存储)。

1.2 数据库 Schema 设计：
    - Accounts 表：存储 AK/SK、Region 列表、账号状态(Active/Dead)、剩余配额。
    - Instances 表：存储 实例ID、所属账号、分配的用户ID、公网IP、随机初始密码、到期时间。
    - Logs 表：记录 API 调用历史和报错信息，用于风控预判。

1.3 安全隔离：
    - 配置 DO Functions 的环境变量，严禁将密钥明文写入代码。
    - 准备一套 HTTP 代理池方案，用于 API 调用时的 IP 伪装。

----------------------------------------------------------------
第二阶段：核心后端开发 (Core Backend Logic)
----------------------------------------------------------------
2.1 账号调度器 (Account Dispatcher)：
    - 开发 get_available_account 逻辑：根据目标 Region 和账号健康度，自动选择最优 AWS 账号。
    
2.2 自动化部署引擎 (Deployment Engine)：
    - 集成 Boto3：实现 run_instances 功能。
    - UserData 模板化：动态生成重置 root 密码、开启 SSH 密码登录的 Shell 脚本。
    - 状态侦听：实现等待公网 IP 分配的轮询逻辑。

2.3 异常拦截器 (Exception Handler)：
    - 专门处理 ClientError：一旦捕获到 AuthFailure (封号)，自动拉黑该账号并触发重试机制切换至下一个可用账号。

----------------------------------------------------------------
第三阶段：自动化监控与补机系统 (Self-Healing & Monitor)
----------------------------------------------------------------
3.1 定时巡检脚本 (Cron Job)：
    - 设置每 5-10 分钟运行一次。
    - 对比“数据库预期实例数”与“AWS 实际运行数”。
    - 发现机器 Missing 或 Status 为 Terminated，立即触发自动补机。

3.2 账号存活检测：
    - 定期调用简单的 DescribeRegions 接口，确保存储的 AK/SK 依然有效。

----------------------------------------------------------------
第四阶段：可视化中控台开发 (Frontend & API)
----------------------------------------------------------------
4.1 FastAPI 接口层：
    - /api/deploy：接收下单指令，触发开机流程。
    - /api/status：查询指定实例的实时状态和 IP。
    - /api/admin/accounts：管理 AWS 账号池（增删改查）。

4.2 客户端面板 (Streamlit/React)：
    - 用户登录后可见自己的服务器列表。
    - “一键重装”按钮：后台逻辑为 Terminate 旧机器 -> 开新机器。
    - “一键重启”按钮：调用 ec2.reboot_instances。

----------------------------------------------------------------
第五阶段：商业化交付与通知 (Commercialization)
----------------------------------------------------------------
5.1 Telegram Bot 集成：
    - 开发消息推送模块：部署成功后，Bot 自动发送包含 IP、密码的卡片给用户。
    
5.2 流量平滑切换 (可选)：
    - 对接 Cloudflare API：为每个用户分配一个 CNAME 域名。
    - 补机完成后，自动更新解析记录，用户连接地址无需变动。

5.3 到期自动化：
    - 开发到期检测逻辑：expire_at 到期后自动 Terminate 实例并释放资源。

----------------------------------------------------------------
第六阶段：压力测试与风控优化 (Testing & Risk Control)
----------------------------------------------------------------
6.1 模拟封号测试：
    - 人动使某个账号失效，测试